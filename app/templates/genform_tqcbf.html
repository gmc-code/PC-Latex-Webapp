{% extends "base.html" %}

{% block content %}
<div class="w3-container w3-margin-top">
    <div class="w3-row">

        <!-- Left Column: Form and Image Section -->
        <div class="w3-col l6 m6 s12 w3-padding">
            <!-- Form Section -->
            <form action="{{ link }}" method="post" class="w3-container w3-card-4 w3-light-grey">
                <h2 class="w3-center">{{ title }}</h2>

                {% if error_msg %}
                <p style="color:red;">{{ error_msg }}</p>
                {% endif %}

                <div class="w3-row">
                    <div class="w3-half w3-padding">
                        <label for="title_text">Title Text</label>
                        <input class="w3-input" type="text" name="title_text" id="title_text"
                               value="{{ request.form.get('title_text', title_text) }}" maxlength="30" required>
                    </div>

                    <div class="w3-half w3-padding">
                        <label>Number of Questions
                            <span>({{ num_per_page }} per page, min {{ min_questions }}, max {{ max_questions }}):</span>
                        </label>
                        <input class="w3-input w3-border custom-width"
                               type="number"
                               name="numq"
                               min="{{ min_questions }}"
                               max="{{ max_questions }}"
                               step="1"
                               value="{{ request.form.get('numq', num_per_page) }}"
                               required>
                    </div>
                </div>

                <div class="w3-row">
                    <div class="w3-half w3-padding">
                        <input type="checkbox" id="checkbox1" name="checkbox1" class="w3-check"
                               {% if request.form.get('checkbox1') %}checked{% endif %}>
                        <label for="checkbox1">{{ checkbox_text }}</label>
                    </div>
                </div>

                <div class="w3-row w3-padding w3-margin-right">
                    <fieldset class="w3-col s6 m6 l6">
                        <legend>Choose file type:</legend>
                        <div>
                            <input type="radio" name="file_type" value="pdf" id="pdf"
                                   {% if request.form.get('file_type', 'pdf') == 'pdf' %}checked{% endif %} class="w3-radio">
                            <label for="pdf">PDF File with questions and answers</label>
                        </div>
                        <div>
                            <input type="radio" name="file_type" value="zip" id="zip"
                                   {% if request.form.get('file_type') == 'zip' %}checked{% endif %} class="w3-radio">
                            <label for="zip">ZIP File of separate questions and answers</label>
                        </div>
                    </fieldset>
                </div>

                <div class="w3-row w3-center">
                    <button type="submit" class="w3-button w3-xxlarge w3-section w3-green" id="Generate">
                        Generate <i class="fa-solid fa-download"></i>
                    </button>
                </div>
            </form>

            <!-- JS clamping script -->
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const numInput = document.querySelector('input[name="numq"]');
                const min = parseInt(numInput.min);
                const max = parseInt(numInput.max);

                numInput.addEventListener('input', function() {
                    let val = parseInt(this.value);
                    if (!isNaN(val)) {
                        if (val < min) this.value = min;
                        if (val > max) this.value = max;
                    }
                });
            });
            </script>

        </div> <!-- closes left column -->

        <!-- Right Column: PDF preview or image -->
        <div class="w3-col l6 m6 s12 w3-padding">
            <div class="w3-card-4">
                <div class="w3-container">
                    <p class="w3-left">Sample PDF</p>
                </div>
                <embed src="/static/pdfs/{{ pdf_filename }}" type="application/pdf" width="100%" height="1200px">
            </div>
        </div>

    </div> <!-- closes .w3-row -->
</div> <!-- closes .w3-container -->
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/progress-bar.js') }}"></script>
{% endblock %}
